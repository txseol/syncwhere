generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model UserData {
  id               String          @id @default(uuid()) @db.Uuid
  provider         String          @default("google")
  providerId       String          @map("provider_id")
  email            String?
  name             String?
  picture          String?
  createdAt        DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime        @updatedAt @map("updated_at") @db.Timestamptz(6)
  status           Int             @default(0)
  createdChannels  ChannelData[]
  channelMembers   ChannelMember[]
  createdDocuments DocumentData[]
  logins           UserLogin[]

  @@unique([provider, providerId])
  @@map("user_data")
}

model UserLogin {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  platform  String
  ip        String?
  userAgent String?  @map("user_agent")
  loginAt   DateTime @default(now()) @map("login_at") @db.Timestamptz(6)
  user      UserData @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([loginAt])
  @@map("user_login")
}

model ChannelData {
  id         String          @id @default(uuid()) @db.Uuid
  name       String          @unique
  createdBy  String          @map("created_by") @db.Uuid
  createdAt  DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime        @updatedAt @map("updated_at") @db.Timestamptz(6)
  visibility Int             @default(0)
  status     Int             @default(0)
  creator    UserData        @relation(fields: [createdBy], references: [id], onDelete: Cascade)
  members    ChannelMember[]
  documents  DocumentData[]

  @@index([createdBy])
  @@index([visibility])
  @@index([status])
  @@map("channel_data")
}

model ChannelMember {
  id         String      @id @default(uuid()) @db.Uuid
  channelId  String      @map("channel_id") @db.Uuid
  userId     String      @map("user_id") @db.Uuid
  permission Int         @default(1)
  status     Int         @default(0)
  joinedAt   DateTime    @default(now()) @map("joined_at") @db.Timestamptz(6)
  joinOrder  Int         @map("join_order")
  channel    ChannelData @relation(fields: [channelId], references: [id], onDelete: Cascade)
  user       UserData    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([channelId, userId])
  @@index([channelId])
  @@index([userId])
  @@index([status])
  @@map("channel_member")
}

model DocumentData {
  id        String      @id @default(uuid()) @db.Uuid
  channelId String      @map("channel_id") @db.Uuid
  name      String
  content   String      @default("")
  status    Int         @default(0)
  createdBy String      @map("created_by") @db.Uuid
  createdAt DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime    @updatedAt @map("updated_at") @db.Timestamptz(6)
  depth     Int         @default(0)
  dir       String      @default("root")
  channel   ChannelData @relation(fields: [channelId], references: [id], onDelete: Cascade)
  creator   UserData    @relation(fields: [createdBy], references: [id], onDelete: Cascade)

  @@unique([channelId, dir, depth, name])
  @@index([channelId])
  @@index([createdBy])
  @@index([status])
  @@index([dir, depth])
  @@map("document_data")
}
